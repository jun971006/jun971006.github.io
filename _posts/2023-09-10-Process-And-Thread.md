---
title:  "[Study] CS 스터디 - 프로세스와 스레드"

categories:
  - CS
tags:
  - Process
  - Thread
  - MultiProcessing
  - Mutex

last_modified_at: 2023-09-10T19:10:00-05:00

toc: true
toc_sticky: true
toc_label: "목차"
---

## 프로세스와 스레드

### 멀티프로세싱
멀티프로세싱은 동시에 여러 프로세스나 작업을 실행하는 기술입니다.
프로그램을 작은 단위로 분할하여 동시에 실행시키며, 시스템의 성능과 효율성을 향상시키는데 사용합니다.

#### 1. 웹 브라우저
멀티프로세서의 예로 웹 브라우저를 설명할 수 있는데,

- 브라우저 프로세서의 경우 사용자와 상호 작용하면서 사용자의 요청에 대한 프로세스를 담당합니다.
  - 예를 들어 뒤로 가기 버튼, 새로운 탭 열기 등이 있습니다.
- 렌더러 프로세스의 경우 각각 HTML, CSS, JavaScript를 해석하고 웹 페이지를 화면에 표시합니다.
- 이외에 플러그인, GPU 프로세스 등이 있습니다.

이렇게 멀티프로세서로 웹 브라우저를 운용할 경우 하나의 탭이 오류가 나더라도 다른 탭은 정상적으로 작동할 수 있으며, 보안성과 안정성을 향상시켜줍니다. 또한 탭들을 병렬적으로 처리해서 페이지 로드 속도를 향상시킬 수 있습니다.

#### 2. IPC
멀티프로세스는 IPC(Inter Process Communication)이 가능하여 프로세스끼리 데이터를 주고받고 공유 데이터를 관리합니다.

##### IPC 종류
이러한 IPC의 종류로는 공유 메모리, 파일, 소켓, 익명/명명 파이프, 메시지 큐가 있습니다.

###### 1) 공유 메모리
공유 메모리는 여러 프로세스에 동일한 메모리 영역에 대한 접근 권한이 부여되어 공유 메모리를 통해 통신하는 것입니다.

각 프로세스는 서로의 메모리에 접근할 수 없기 때문에 공유 메모리를 통해  데이터를 주고받습니다.

하드웨어 관점에서 봤을 때 RAM이 CPU가 접근할 수 있는 큰 랜덤 공유 메모리라고도 가르킵니다.

###### 2) 파일
파일은 디스크에 저장된 데이터


###### 3) 소켓
소켓은 동일한 컴퓨터 내의 다른 프로세스나 네트워크 상의 프로세스 간 통신에 사용됩니다.
양방향 통신을 제공하며, TCP, UDP가 있습니다.

###### 4) 익명 파이프 
익명 파이프(nonamed pipe)는 프로세스간에 FIFO(First In First Out) 방식의 임시 공간인 파이프를 통해 데이터를 주고받고, 단방향의 읽기, 쓰기를 제공합니다.

###### 5) 명명된 파이프
명명된 파이프(named pipe)는 파이프 서버와 하나 이상의 파이프 클라이언트 간의 통신을 위한 명명된 단방향 or 양방향 파이프입니다.

![](/assets/images/study/cs/named%20pipe.png)

보통 서버용 / 클라이언트용 파이프로 구분해서 작동하며 하나의 인스턴스를 열거나 여러 개의 인스턴스를 기반으로 통신합니다.

###### 6) 메시지 큐
메시지 큐는 메시지를 큐(queue) 데이터 구조 형태로 관리하는 것을 의미합니다. 주로 비동기 통신에서 주로 사용합니다.

### 스레드와 멀티스레딩

#### 1. 스레드
스레드는 프로세스의 실행 가능한 가장 작은 단위입니다.
또한 프로세스는 여러개의 스레드를 가질 수 있습니다.

#### 2. 멀티스레드
멀티스레딩은 프로세스 내의 작업을 여러 개의 스레드 즉, 멀티 스레드로 처리하는 기법입니다.
대표적인 예로 웹 서버가 있으며, 요청에 대한 처리를 할 때 한 스레드가 중단되어도 다른 스레드는 실행 상태일 수 있기 때문에 중단되지 않고 빠르게 처리가 가능합니다.


##### 장점
장점은로는 스레드 간의 작업량이 작아 Context Switching이 빠릅니다.
또한 스레드 간 데이터를 간단하게만 주고 받기 때문에 시스템 자원 모소가 줄어듭니다.

##### 단점
단점으로는 설계와 디버깅이 까다로우며, 멀티 스레드의 경우 자원 공유의 문제가 발생합니다.

> Context Switching
Context Switching이란 CPU가 여러 프로세스를 돌아가면서 작업을 처리하는 것을 말합니다.

### 공유 자원과 임계 영역

#### 공유 자원
공유 자원(shared resource)은 시스템 안에서 각 프로세스와 스레드가 함계 접근할 수 있는 모니터, 프린터, 메모리, 파일 등의 자원이나 변수를 뜻합니다.

이러한 공유 자원을 두 개 이상의 프로세스가 동시에 읽거나 쓰는 상황을 경쟁 상태(race condition)이라고 합니다.

예를 들어 철수의 계좌에는 100$가 있는데,
철수와 영희가 동시에 다른 ATM기를 가지고 각각 60$씩 인출하려고 하는 상황이다.<br>
이 때 60$씩 인출을 하게 된다면 초과 인출을 하게 되는 상황이다.<br>
이런식으로 거래의 동시성과 동기화 이슈로 인해 뮤텍스, 세마포어 등과 같은 동기화 도구를 사용해야합니다.

#### 임계 영역
임계 영역(Critical Section)이란 둘 이상의 프로세스, 스레드가 공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 코드 영역을 뜻합니다. 

이러한 임계 영역의 해결 방법으로는 크게 뮤텍스, 세마포어, 모니터가 있으며, 이 방법들 모두 상호 배제, 한정 대기, 융통성의 조건을 만족합니다.

> 상호 배제 : 한 프로세스가 임계 영역에 들어가면 다른 프로세스는 들어가지 못합니다.
- ex) 화장실<br>

> 한정 대기 : 특정 프로세스가 영원히 임계 영역에 들어가지 못하면 안되는 조건입니다.<br>

> 융통성 : 한 프로세스가 다른 프로세스의 일을 방해하면 안되는 조건입니다.<br>

##### 뮤텍스
뮤텍스(mutex)는 프로세스나 스레드가 공유 자원을 lock()을 통해 잠금 설정하고 사용한 뒤 unlock()을 통해 잠금 해제하는 객체입니다.

이는 하나의 스레드나 프로세스만 공유 자원에 접근할 수 있도록 해줍니다. 

##### 세마포어
세마포어는 공유 자원에 대해서 단독으로 접근하는 권한을 보장하는 대신에 접근할 수 있는 스레드나 프로세스의 수를 제한/제어하는데 사용합니다.

###### wait(), signal()
세마포어는 두 가지의 기능을 통해 공유 자원에 대한 접근을 처리합니다.

- wait()
  - 세마포어를 사용하기 위해 기다리는 함수입니다.
  
- signal()
  - 공유 자원에 대한 접근을 처리합니다.

프로세스나 스레드가 공유 자원에 접근하면 세마포어에서 wait()작업을 수행하고, 공유 자원을 해제하면 세마포어에서 signal() 작업을 수행합니다.

###### 1) 바이너리 세마포어
바이너리 세마포어는 0과 1 처럼 두 가지 값으로 제한 된 세마포어로, 신호를 기반으로 상호 배제가 일어나는 '신호 메커니즘' 입니다.

예를 들어 노래를 듣고 있다가 전화가 오면 노래가 끊기는 상황을 생각할 수 있습니다.

###### 2) 카운팅 세마포어
카운팅 세마포어는 여러 개의 값을 가질 수 있는 세마포어로, 여러 자원에 대한 접근을 제어합니다.

##### 모니터
모니터는 둘 이상의 스레드나 프로세스가 공유 자원에 안전하게 접근할 수 있도록 공유자원에 대한 접근 인터페이스를 제공합니다.

![](/assets/images/study/cs/monitor.png)

모니터 큐를 통해서 작업들을 순차적으로 처리합니다.

### 교착 상태
교착 상태(deadlock)은 두 개 이상의 프로세스들이 자원을 기다리며 중단된 상태를 말합니다.

예를 들어 철수와 영희가 서로 이체를 하려고 하는 상태입니다.
여기서 철수는 이체를 위해 계좌를 잠금(lock)하고, 영희도 동시에 이체를 위해 계좌를 잠금(lock)합니다. 이 때 철수와 영희는 각각 계좌에 접근을 시도하지만 잠금되어 있는 상태이기 때문에 접근이 불가합니다.
이런 상황을 교착 상태라고 합니다.

#### 교착 상태의 원인
- 상호 배제 : 한 프로세스가 자원을 독점하고 있어서 다른 프로세스의 접근이 불가합니다.
- 점유 대기 : 프로세스가 점유한 자원을 다른 프로세스가 요청한 상태입니다. 서로의 자원을 사용하기 위해 대기하고 있는 상태입니다.
- 비선점 : 프로세스가 점유한 자원을 다른 프로세스로부터 선점할 수 없는 조건입니다.<br> 이러한 특성 때문에 오히려 교착 상태가 발생할 수 있는데
철수와 영희가 서로 이체를 미루는 상황을 예로 들 수 있습니다.
<br>서로의 프로세스를 선점하지 않으려고 미루다가 아무도 작업을 수행하지 않는 상황입니다.
- 환형 대기 : 각각 다음의 자원을 얻기 위해서 대기하고 있는데 이미 사용되고 있을 때, 순환 형태로 대기하는 상황이 발생합니다.

#### 교착 상태 해결방법
- 교착 상태를 탐지하는 알고리즘을 도입합니다.
  - 교착 상태의 프로세스를 종료하거나 중단합니다.
  - 교착 상태에 빠진 프로세스의 자원을 강제로 해제합니다.
- 프로세스당 자원 요청 최대치 알고리즘을 도입합니다.
- 하지만 현대 운영체제는 교착 상태에 대한 처리 비용이 더 크다고 판단하고, 매우 드물게 일어나는 현상이기 때문에 <br>교착 상태가 발생하면 작업을 종료합니다. 예를 들어 윈도우 운영체제에서 어떤 프로그램을 사용하다가 '응답없음' <br>이라는 메시지가 나오면서 <종료되는 현상을 마주친적이 있을텐데, 바로 이 교착 상태 상황입니다.


### reference

[참고블로그1](https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html)