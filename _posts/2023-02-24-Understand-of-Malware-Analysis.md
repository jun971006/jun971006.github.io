---
title:  "[Security] 악성코드 분석 기초"

categories:
  - Security
tags:
  - Security
  - Malware
last_modified_at: 2023-02-28T01:16:00-05:00

toc: true
toc_sticky: true
toc_label: "목차"
---

## 서론

비록 군인의 신분이지만 악성코드 분석을 하는 현직자로서 나중을 위해 기록을 남겨보려고 한다.

나름 수도권 4년제 컴공과 졸업생의 신분으로 수많은 소스코드와 프로그래밍 언어를 다뤄봤기 때문에<br/> 악성코드 분석도 금방 할 수 있을거라 생각했다.

근데 이게 왠걸... 소스코드 비슷한게 있긴 한데 도저히 읽을수가 없었다..

보안 업무도 처음이고 악성코드 분석도 처음인 분들한테 이 글이 도움이 되었으면 하는 마음으로 작성해보겠다.

## 악성코드 분석

우선 악성코드 분석을 하기 위해서는 악성코드 샘플이 필요하다.


### 악성코드 수집
악성코드 샘플을 수집하는 방법으로는

1. VirusTotal(VT)에서 Yara rule을 통해 Hunting 해서 수집하는 방법
2. Twitter, 보안 회사가 제공하는 악성코드 분석 보고서에 나와있는 해시를 수집한 후 <br/> 무료 샘플 제공 사이트 해시 검색을 통해 수집하는 방법
    - malshare.com : VT만큼은 아니지만 악성코드의 해시를 알고 있을 때, <br/> &emsp;&emsp;&emsp;&emsp;&emsp;&emsp; API Key만 발급받으면 샘플 수집이 가능하다.
3. 직접 공격자의 C2서버를 확보해서 악성코드를 수집하는 방법 등이 있다.

이렇게 수집한 악성코드를 분석하기 전에 악성코드의 유형을 파악하는게 중요한데,
크게 문서형, 실행형, 모바일형 등으로 나눈다.

### 악성코드 유형
1. 문서형 악성코드

    문서형 악성코드에는 한글파일인 hwp, 워드 문서인 doc, docx, 매크로 형태의 dotm, 등이 존재하는데, <br/> 최근에 안랩에서 업로드한 https://asec.ahnlab.com/ko/47147/ 관련 내용을 정리해보려 한다.

    우선 샘플을 수집했다는 전제하에 악성 워드 문서를 실행하면 <br/>
    콘텐츠를 불러올 수 없다는 문구와 함께 "콘텐츠 사용" 버튼 실행을 유도한다.

    <img src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2023/02/main.png?resize=1024%2C645&ssl=1" width="100%" height="100%" title="Github_Logo"/>
    
    이 때, "콘텐츠 사용" 버튼을 누르게 되면 word/\_rels/settings.xml.rels 파일에 설정되어 있는 악성 외부 링크가 실행되며 <br/> 공격자가 C2서버에 업로드해놓은 악성 매크로 파일에 접근 후 실행하게 된다.

    안랩 블로그에서 게시한 악성 URL은 총 5가지다.
    - hxxp://www.hydrotec.co[.]kr/bbs/img/cmg/upload2/init.dotm
    - hxxp://www.hydrotec.co[.]kr/bbs/img/cmg/upload3/init.dotm
    - hxxp://jooshineng[.]com/gnuboard4/adm/img/ghp/up/state.dotm
    - hxxp://gdtech[.]kr/gnuboard4/adm/cmg/attatch/init.dotm
    - hxxp://ddim.co[.]kr/gnuboard4/adm/cmg/upload/init.dotm

    > 출처 : asec.ahnlab.com/ko/47147