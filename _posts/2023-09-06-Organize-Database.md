---
title:  "[Study] CS 스터디 - 데이터베이스 정리"

categories:
  - CS
tags:
  - Database
  - Transaction
  - integrity

last_modified_at: 2023-09-06T19:10:00-05:00

toc: true
toc_sticky: true
toc_label: "목차"
---

## 데이터베이스

### 트랜잭션과 무결성

트랜잭션이란 데이터베이스 관리에서 아주 중요한 개념으로 하나의 논리적 기능을 수행하기 위한 작업의 단위를 말합니다.
<br>
여기서 핵심은 하나의 논리적 기능 안에는 다수의 쿼리를 하나로 묶어서 수행한다는 뜻입니다.
<br>
여기서 쿼리란 데이터베이스로부터 데이터를 검색, 조작, 삽입 등 다양한 작업을 위해 수행하는 단위입니다.

#### ACID
이러한 트랜잭션의 특성으로는 원자성, 일관성, 독립성, 지속성이 있으며 이를 ACID라고 부릅니다.
![](https://media.geeksforgeeks.org/wp-content/cdn-uploads/20191121102921/ACID-Properties.jpg)

##### 1. 원자성(atomicity)
원자성이란 트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징입니다.

원자성을 예로들어 설명할 때는 은행에서 돈을 송금하고 입금받는 상황을 자주 설명합니다.

여기 철수와 영희가 있습니다.

철수가 영희에게 10만원을 줘야하는 상황이라고 가정해봅시다.

1. 철수의 은행계좌에서 10만원이 있는지 확인한다.
2. 철수의 계좌에서 10만원이 빠져나간다.
3. 영희의 계좌에 10만원이 꽂힌다.

```sql
BEGIN TRANSACTION; -- 트랜잭션 시작

-- 철수 계좌에서 10만원 인출
UPDATE accounts SET balance = balance - 100 WHERE account_number = 'CheolsuAccount';

-- 영희 계좌에 10만원 입금
UPDATE accounts SET balance = balance + 100 WHERE account_number = 'YoungheeAccount';

-- 커밋
COMMIT;
```

위에서 제시한 3가지의 과정중에서 하나라도 수행되지 않으면 우리의 계좌 송금은 실패하게됩니다.

정리해보면 이러한 1~3의 상황을 하나의 작업 단위로 묶어서 수행하는것을 트랜잭션이라고 하고, 
<br>
이 트랜잭션을 수행하기 위해 커밋을 진행해도, 문제가 생겨 다시 롤백을 진행했을 때 트랜잭션이 수행되지 않음을 보장하는 특징입니다.

> 커밋과 롤백
<br>
<br>
<strong>커밋</strong>이란 쿼리가 성공적으로 처리되었다고 확정하는 명령어로, 
<br>
트랜잭션 단위로 수행되며 변경 내용을 영구적으로 저장하는것을 뜻합니다.
<br><br>
<strong>롤백</strong>은 이와 반대로 상태를 트랜잭션 이전으로 돌릴 때 사용합니다. 
<br><br>
이러한 커밋과 롤백의 특성을 통해 데이터의 무결성을 보장합니다.

##### 2. 일관성
일관성이란 어떤 트랜잭션이 미리 정의된 규칙과 제약 조건을 준수하고, 데이터베이스가 일관된 상태를 보장하는 특징입니다.

예를 들어

철수는 은행에 A, B계좌가 있습니다.
<br>
A계좌에는 2만원, B계좌에는 3만원 총 5만원이 있다고 가정했을 때
<br>
A에서 B계좌로 1000원을 옮기면 
A계좌에는 19000, B계좌에는 31000 총 5만원이 그대로 유지되어야 합니다.

이렇게 트랜잭션 이후에 데이터베이스의 상태에 대한 일관성을 보장해줍니다.

##### 3. 격리성
격리성이란 동시에 수행되는 트랜잭션이 서로 간섭받지 않도록 보장합니다.

예를 들어

철수가 영희에게 송금을 하는 작업을 진행 중인데,
<br>
이 때 영희가 본인의 계좌에 얼마가 있는지 확인하는 작업을 수행해도
<br>
두 작업은 서로 간섭하지 않고, 독립적으로 수행될 수 있도록 보장합니다.

이러한 격리성은 다음의 수준으로 나워서 보장합니다.

###### 1) Read Uncommitted
###### 2) Read Committed
###### 3) Repeatable Read
###### 4) Serializable

내려갈수록 트랜잭션 간의 격리 정도가 높아지고, 성능이 떨어집니다.
<br>일반적인 온라인 서비스에서는 Read Committed나 Repeatable Read 중 하나를 선택해서 수행합니다.

- Read Uncommitted
  - 하나의 트랜잭션이 다른 트랜잭션에 의해서 수행된 <strong>커밋되지 않은</strong> 변경 사항을 볼 수 있습니다.
    - ex) 철수가 영희에게 10만원을 이체 중이다.
    - 동시에 영희는 자신의 계좌를 확인하고있다.
    - 영희는 확인하는 동안 자신의 잔액이 바뀐것을 볼 수 있다.
  - 이렇게 최고의 동시성을 제공하지만, 데이터 일관성을 희생하는 것을 볼 수 있습니다.

- Read Committed
  - 하나의 트랜잭션은 다른 트랜잭션에서 커밋된 변경 사항만 볼 수 있습니다.
- Repeatable Read
  - 하나의 트랜잭션은 다른 트랜잭션의 변경 사항에 관계없이 동일한 데이터를 보도록 보장됩니다.
    - ex) 철수가 영희에게 10만원을 이체 중이다.
    - 영희가 다른 은행 업무 중에 철수의 이체가 완료된다.
    - 영희의 계좌에는 아직 10만원이 더하기 전의 계좌 잔액이 나온다.
- Serializable
  - 트랜잭션이 순차적으로 실행되어 최고 수준의 데이터 일관성을 보장합니다.
  - 주로 은행같이 데이터 의 일관성이 매우 중요한 경우 동시성을 희생하더라도 이 격리 수준을 사용합니다.

> oracle : Read Committed
<br>mysql : Repeatable Read

##### 4. 지속성

지속성은 트랜잭션이 성공적으로 수행되었을 때, 해당 작업을 통해 변경된 사항은 영구적이며, 
<br>
만약 데이터베이스 같은 시스템이 오류가 생겨도 일관된 상태로 유지되는 특징입니다.

예를 들어

철수가 영희에게 만원을 성공적으로 송금을 한 뒤, 
<br>은행 어플이 점검을 진행해도 이미 송금한 만원은 
<br>영희의 계좌에 안전하게 남아있는 것이라고 볼 수 있습니다.


#### 무결성
무결성이란 데이터의 정확성, 일관성, 유효성을 유지하는 것을 말합니다.
<br>
이러한 무결성이 유지되어야 데이터베이스에 저장된 데이터 값과 현실 세계의 실제 값이 일치한다는 신뢰가 생깁니다.

##### 종류
1. 개체 무결성
- PK로 선택된 필드는 빈 값을 허용하지 않는다.
2. 참조 무결성
- 서로 참조하는 테이블의 데이터는 항상 일관된 값을 유지한다.
3. 고유 무결성
- 특정 속성에 대해 고유값을 가지는 조건이 있을경우, 그 속성은 모두 고유값을 가져야 한다.
4. NULL 무결성
- 특정 속성에 대한 NULL이 올 수 없는 조건이 있을경우, 그 속성은 NULL이 될 수 없다.

#### Reference 
[TheBook - 면접을 위한 CS 전공지식 노트](https://thebook.io/080326/) <br/>
[chatGPT](https://chat.openai.com/) <br/>
[geeksforgeeks - dbms에서의 acid](https://www.geeksforgeeks.org/acid-properties-in-dbms/)


<hr>